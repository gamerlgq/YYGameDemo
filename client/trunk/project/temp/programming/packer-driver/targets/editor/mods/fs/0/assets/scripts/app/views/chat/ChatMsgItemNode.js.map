{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/YYGameDemo/client/trunk/project/assets/scripts/app/views/chat/ChatMsgItemNode.ts"],"names":["ChatMsgItemNode","_decorator","Node","NodePool","UITransform","instantiate","Widget","widgetManager","v3","ChatMsgItemComp","ccclass","property","constructor","prefab","_chatMsgItemPrefab","_uiTransComp","addComponent","anchorX","height","widget","alignMode","AlignMode","ON_WINDOW_RESIZE","alignFlags","AlignFlags","HORIZONTAL","left","right","on","EventType","SIZE_CHANGED","_updateView","bind","setData","idx","name","text","_playerName","_text","_chatMsgItemNode","nodeComp","getComponent","playerName","setRichLabelMaxWidth","width","getRichHeight","position","x","reuse","msgNode","chatMsgNodePool","get","addChild","unuse","put","createNode"],"mappings":";;;gIAiBaA,e;;;;;;;;;;;;;;;AAhBJC,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;AAAkBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAqBC,MAAAA,a,OAAAA,a;AAAkCC,MAAAA,E,OAAAA,E;;AAChIC,MAAAA,e,iBAAAA,e;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;iCAEaD,e,GAAN,MAAMA,eAAN,SAA8BE,IAA9B,CAAmC;AAWtCU,QAAAA,WAAW,CAAEC,MAAF,EAAU;AACjB;;AADiB;;AAAA;;AAAA;;AAAA;;AAAA;;AAEjB,eAAKC,kBAAL,GAA0BD,MAA1B;AAEA,eAAKE,YAAL,GAAoB,KAAKC,YAAL,CAAkBZ,WAAlB,CAApB;AACA,eAAKW,YAAL,CAAkBE,OAAlB,GAA4B,CAA5B;AACA,eAAKF,YAAL,CAAkBG,MAAlB,GAA2B,EAA3B;AAEA,cAAIC,MAAM,GAAG,KAAKH,YAAL,CAAkBV,MAAlB,CAAb;AACAa,UAAAA,MAAM,CAAEC,SAAR,GAAoBd,MAAM,CAACe,SAAP,CAAiBC,gBAArC;AACAH,UAAAA,MAAM,CAAEI,UAAR,GAAqBhB,aAAa,CAACiB,UAAd,CAAyBC,UAA9C;AACAN,UAAAA,MAAM,CAAEO,IAAR,GAAe,CAAf;AACAP,UAAAA,MAAM,CAAEQ,KAAR,GAAgB,CAAhB;AAEA,eAAKC,EAAL,CAAQ1B,IAAI,CAAC2B,SAAL,CAAeC,YAAvB,EAAqC,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAArC;AACH;;AAGDC,QAAAA,OAAO,CAACC,GAAD,EAAaC,IAAb,EAA0BC,IAA1B,EAAgC;AACnC,eAAKC,WAAL,GAAmBF,IAAnB;AACA,eAAKG,KAAL,GAAaF,IAAb;;AACA,eAAKL,WAAL;AACH;;AAEDA,QAAAA,WAAW,GAAE;AACT,cAAI,KAAKQ,gBAAT,EAA2B;AAEvB;AACA,gBAAIC,QAAQ,GAAG,KAAKD,gBAAL,CAAsBE,YAAtB;AAAA;AAAA,mDAAf;;AACAD,YAAAA,QAAQ,CAACE,UAAT,GAAsB,KAAKL,WAA3B;AACAG,YAAAA,QAAQ,CAACJ,IAAT,GAAgB,KAAKE,KAArB,CALuB,CAOvB;;AACAE,YAAAA,QAAQ,CAACG,oBAAT,CAA8B,KAAK5B,YAAL,CAAkB6B,KAAhD;AACA,iBAAK7B,YAAL,CAAkBG,MAAlB,GAA2BsB,QAAQ,CAACK,aAAT,EAA3B,CATuB,CAYvB;;AACA,iBAAKN,gBAAL,CAAsBO,QAAtB,GAAiCtC,EAAE,CAAE,KAAK+B,gBAAL,CAAsBO,QAAtB,CAA+BC,CAAjC,EAAoC,KAAKhC,YAAL,CAAkBG,MAAlB,GAA2B,CAA/D,EAAiE,CAAjE,CAAnC;AACH;AACJ,SAnDqC,CAqDtC;;;AACA8B,QAAAA,KAAK,GAAG;AACJ,cAAI,KAAKT,gBAAT,EAA2B;AACvB;AACH;;AAED,cAAIU,OAAO,GAAGjD,eAAe,CAACkD,eAAhB,CAAgCC,GAAhC,EAAd;;AACA,cAAI,CAACF,OAAL,EAAc;AACVA,YAAAA,OAAO,GAAG5C,WAAW,CAAC,KAAKS,kBAAN,CAArB;AACH;;AACD,eAAKsC,QAAL,CAAcH,OAAd;AACA,eAAKV,gBAAL,GAAwBU,OAAxB;;AAEA,eAAKlB,WAAL;AACH;;AAEDsB,QAAAA,KAAK,GAAI;AACL,cAAI,KAAKd,gBAAT,EAA2B;AACvBvC,YAAAA,eAAe,CAACkD,eAAhB,CAAgCI,GAAhC,CAAoC,KAAKf,gBAAzC;AACH;;AACD,eAAKA,gBAAL,GAAwB,IAAxB;AACH;;AAEOgB,QAAAA,UAAU,GAAG,CAEpB;;AA9EqC,O;AAiF1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;sBA1FavD,e,qBAEgC,IAAIG,QAAJ,E","sourcesContent":["\nimport { _decorator, Component, Node, NodePool, Prefab, UITransform, instantiate, Widget, find, Label, widgetManager, log, RichText, v2, v3, TweenSystem } from 'cc';\nimport { ChatMsgItemComp } from './ChatMsgItemComp';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = ChatMsgItem\n * DateTime = Thu Mar 17 2022 14:32:09 GMT+0800 (中国标准时间)\n * Author = maikx123456\n * FileBasename = ChatMsgItem.ts\n * FileBasenameNoExtension = ChatMsgItem\n * URL = db://assets/scripts/app/views/chat/ChatMsgItem.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\n *\n */\n\nexport class ChatMsgItemNode extends Node {\n    \n    public static chatMsgNodePool:NodePool = new NodePool\n    private _chatMsgItemPrefab:Prefab;\n    private _chatMsgItemNode:Node; \n    private _uiTransComp:UITransform;\n\n    private _playerName:string;\n    private _text:string;\n\n\n    constructor (prefab) {\n        super()\n        this._chatMsgItemPrefab = prefab\n\n        this._uiTransComp = this.addComponent(UITransform)\n        this._uiTransComp.anchorX = 0\n        this._uiTransComp.height = 50\n    \n        let widget = this.addComponent(Widget)\n        widget!.alignMode = Widget.AlignMode.ON_WINDOW_RESIZE;\n        widget!.alignFlags = widgetManager.AlignFlags.HORIZONTAL\n        widget!.left = 0;\n        widget!.right = 0;\n\n        this.on(Node.EventType.SIZE_CHANGED, this._updateView.bind(this))\n    }\n\n\n    setData(idx:number, name:string, text) {\n        this._playerName = name;\n        this._text = text;\n        this._updateView()\n    }\n    \n    _updateView(){\n        if (this._chatMsgItemNode) {\n\n            //更新数据\n            let nodeComp = this._chatMsgItemNode.getComponent(ChatMsgItemComp)\n            nodeComp.playerName = this._playerName\n            nodeComp.text = this._text\n\n            //更新富文本长度\n            nodeComp.setRichLabelMaxWidth(this._uiTransComp.width)\n            this._uiTransComp.height = nodeComp.getRichHeight()\n\n\n            //置顶\n            this._chatMsgItemNode.position = v3( this._chatMsgItemNode.position.x, this._uiTransComp.height / 2,0)\n        }\n    }\n\n    //刷新item\n    reuse() {\n        if (this._chatMsgItemNode) {\n            return\n        }\n\n        let msgNode = ChatMsgItemNode.chatMsgNodePool.get()\n        if (!msgNode) {\n            msgNode = instantiate(this._chatMsgItemPrefab)\n        }\n        this.addChild(msgNode)\n        this._chatMsgItemNode = msgNode\n\n        this._updateView()\n    }\n\n    unuse () {\n        if (this._chatMsgItemNode) {\n            ChatMsgItemNode.chatMsgNodePool.put(this._chatMsgItemNode)\n        }\n        this._chatMsgItemNode = null\n    }\n\n    private createNode() {\n        \n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/zh/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/zh/scripting/life-cycle-callbacks.html\n */\n"]}