{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/YYGameDemo/client/trunk/project/assets/scripts/app/views/fight/FightMainWorld.ts"],"names":["FightMainWorld","error","Node","UITransform","UIWidget","FightConstant","BloodLayer","DialogLayer","FomationLayer","RoleLayer","TopEffectLayer","Map","init","addComponent","_initLayers","_addLayers","_layerMap","set","FightLayer","FORMATION","_createNode","BOTTM_EFFECT","ROLE","TOP_EFFECT","BLOOD","DIALOG","name","node","addChild","_formationLayer","addCommonentInLayer","_roleLayer","_topEffectLayer","_bloodLayer","_dialogLayer","startGame","tick","dt","getLayer","index","get","toString","getLayerByName","layerName","getChildByName","insertChildInLayer","child","siblingIndex","layer","setSiblingIndex","com","getCommonentInLayer","comp","getComponent"],"mappings":"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","sourcesContent":["import { Component, error, log, Node, UITransform } from \"cc\";\nimport { UIWidget } from \"../../../framework/ui/UIWidget\";\nimport { FightConstant } from './FightConstant';\nimport { BloodLayer } from \"./layer/BloodLayer\";\nimport { DialogLayer } from \"./layer/DialogLayer\";\nimport { FomationLayer } from \"./layer/FomationLayer\";\nimport { RoleLayer } from \"./layer/RoleLayer\";\nimport { TopEffectLayer } from \"./layer/TopEffectLayer\";\nexport class FightMainWorld extends Node{\n    \n    // 层级管理\n    private _layerMap:Map<number,Node> = new Map<number,Node>();\n\n    private _formationLayer:FomationLayer = null;\n\n    private _roleLayer:RoleLayer = null;\n\n    private _topEffectLayer:TopEffectLayer = null;\n\n    private _bloodLayer:BloodLayer = null;\n\n    private _dialogLayer:DialogLayer = null;\n\n    /**\n     * @description 初始化\n     */\n    public init() {\n        this.addComponent(UITransform);\n        this.addComponent(UIWidget);\n        this._initLayers();\n        this._addLayers();\n    }\n\n    private _initLayers() {\n        this._layerMap.set(FightConstant.FightLayer.FORMATION,this._createNode(\"FORMATION\")); //布阵层\n        this._layerMap.set(FightConstant.FightLayer.BOTTM_EFFECT,this._createNode(\"BOTTM_EFFECT\")); //底层特效层\n        this._layerMap.set(FightConstant.FightLayer.ROLE,this._createNode(\"ROLE\")); //角色层\n        this._layerMap.set(FightConstant.FightLayer.TOP_EFFECT,this._createNode(\"TOP_EFFECT\")); //上层特效层\n        this._layerMap.set(FightConstant.FightLayer.BLOOD,this._createNode(\"BLOOD\")); //数字层\n        this._layerMap.set(FightConstant.FightLayer.DIALOG,this._createNode(\"Dailog\")); //对话层\n    }\n\n    private _createNode(name:string):Node {\n        let node = new Node();\n        node.name = name;\n        node.addComponent(UITransform);\n        node.addComponent(UIWidget);\n        this.addChild(node);\n        return node\n    }\n\n    private async _addLayers() {\n        // 布阵\n        this._formationLayer = this.addCommonentInLayer(FightConstant.FightLayer.FORMATION, FomationLayer);\n        await this._formationLayer.init();\n\n        // 角色\n        this._roleLayer = this.addCommonentInLayer(FightConstant.FightLayer.ROLE, RoleLayer);\n        this._roleLayer.init();\n\n        // 上册技能层\n        this._topEffectLayer = this.addCommonentInLayer(FightConstant.FightLayer.TOP_EFFECT, TopEffectLayer);\n        this._topEffectLayer.init();\n\n        // 上册技能层\n        this._bloodLayer = this.addCommonentInLayer(FightConstant.FightLayer.BLOOD,BloodLayer);\n        this._bloodLayer.init();\n\n        // 对话框层\n        this._dialogLayer = this.addCommonentInLayer(FightConstant.FightLayer.DIALOG,DialogLayer);\n        this._dialogLayer.init();\n    }\n\n    /**\n     * game start\n     */\n    public startGame() {\n        this._formationLayer.startGame();\n        this._roleLayer.startGame();\n    }\n\n    /**\n     * tick\n     */\n    public tick(dt:number) {\n        \n    }\n\n    /**\n     * @description 根据层索引返回层节点\n     * @param index:number 层索引\n     * @return Node | null\n     */\n    public getLayer(index:number):Node | null {\n        if (!this._layerMap.get(index)){\n            error(\"There is not exist layer in FightMainWorld! index:[ %s ]\",index.toString());\n            return null;\n        }\n        return this._layerMap.get(index);\n    }\n\n    /**\n     * \n     * @param layerName string 层级名称\n     * @return Node | null\n     */\n    public getLayerByName(layerName:string):Node | null {\n        return this.getChildByName(layerName);\n    }\n\n    /**\n     * @description 根据层索引往层中添加节点\n     * @param index 层索引\n     * @param node  需要添加的节点\n     * @param siblingIndex? 设置当前节点在父节点的 children 数组中的位置。\n     */\n    public insertChildInLayer(index:number,child:Node,siblingIndex?:number) {\n        let layer = this.getLayer(index);\n        if (layer) {\n            layer.addChild(child);\n            layer.setSiblingIndex(siblingIndex);\n        }\n    }\n\n      /**\n     * @description 根据层索引往层中添加组件\n     * @param index 层索引\n     * @param com  组件\n     */\n    public addCommonentInLayer<T extends typeof Component>(index:number,com:T):InstanceType<T> {\n        let layer = this.getLayer(index);\n        if (layer) {\n            return layer.addComponent(com) as InstanceType<T>;\n        }\n    }\n\n\n    /**\n     * @description 根据层索引往层中添加组件\n     * @param index 层索引\n     * @param com  组件\n     */\n    public getCommonentInLayer<T extends typeof Component>(index:number,com:T):InstanceType<T> {\n        let layer = this.getLayer(index);\n        if (layer) {\n            let comp = layer.getComponent(com);\n            return comp as InstanceType<T>;\n        }\n    }\n}"]}