{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/YYGameDemo/client/trunk/project/assets/scripts/framework/ui/DInertiaMove.ts"],"names":["_decorator","Component","v3","v2","posAdd","ccclass","property","DInertiaMove","onStop","_onStop","value","start","move","byPos","minX","maxX","_autoOffPos","isAutoScrolling","_minX","_maxX","stop","update","deltaTime","multiplyScalar","drag","newPos","node","position","clone","add","x","y","_increasedPos","subtract","dis","length","onPosChange"],"mappings":";;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAoCC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,E,OAAAA,E;;AACpDC,MAAAA,M,iBAAAA,M;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;8BAGaO,Y,WADZF,OAAO,CAAC,cAAD,C,yBAAR,MACaE,YADb,SACkCN,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAAA,wCAGjB,IAHiB;;AAAA,mDAIL,KAJK;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AASvB,YAANO,MAAM,GAAa;AAC1B,iBAAO,KAAKC,OAAZ;AACH;;AACgB,YAAND,MAAM,CAACE,KAAD,EAAkB;AAC/B,eAAKD,OAAL,GAAeC,KAAf;AACH;;AAMDC,QAAAA,KAAK,GAAG,CACP;;AAEDC,QAAAA,IAAI,CAACC,KAAD,EAAcC,IAAd,EAA6BC,IAA7B,EAA4C;AAC5C,eAAKC,WAAL,GAAmBH,KAAnB;AACA,eAAKI,eAAL,GAAuB,IAAvB;AACA,eAAKC,KAAL,GAAaJ,IAAb;AACA,eAAKK,KAAL,GAAaJ,IAAb;AACH;;AAEDK,QAAAA,IAAI,GAAG;AACH,eAAKH,eAAL,GAAuB,KAAvB;AACA,eAAKD,WAAL,GAAmBb,EAAE,CAAC,CAAD,EAAI,CAAJ,CAArB;AACA,eAAKK,MAAL,IAAe,KAAKA,MAAL,EAAf;AACH;;AAEDa,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,cAAI,KAAKL,eAAT,EAA0B;AACtB,iBAAKD,WAAL,GAAmB,KAAKA,WAAL,CAAiBO,cAAjB,CAAgC,KAAKC,IAArC,CAAnB,CADsB,CAGtB;;AACA,gBAAIC,MAAM,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,KAAnB,GAA2BC,GAA3B,CAA+B3B,EAAE,CAAC,KAAKc,WAAL,CAAiBc,CAAlB,EAAqB,KAAKd,WAAL,CAAiBe,CAAtC,CAAjC,CAAb;;AACA,gBAAI,KAAKb,KAAL,IAAcO,MAAM,CAACK,CAAP,GAAW,KAAKZ,KAAlC,EAAyC;AACrCO,cAAAA,MAAM,CAACK,CAAP,GAAW,KAAKZ,KAAhB;AACH;;AACD,gBAAI,KAAKC,KAAL,IAAcM,MAAM,CAACK,CAAP,GAAW,KAAKX,KAAlC,EAAyC;AACrCM,cAAAA,MAAM,CAACK,CAAP,GAAW,KAAKX,KAAhB;AACH;;AAED,iBAAKa,aAAL,GAAqBP,MAAM,CAACQ,QAAP,CAAgB,KAAKP,IAAL,CAAUC,QAA1B,CAArB;;AACA,gBAAIO,GAAG,GAAI,KAAKF,aAAL,CAAmBG,MAAnB,EAAX;;AACA,gBAAID,GAAG,GAAG,CAAV,EACI,KAAKd,IAAL,GADJ,KAEI;AACA;AAAA;AAAA,oCAAO,KAAKM,IAAZ,EAAkB,KAAKV,WAAvB,EAAoC,KAAKE,KAAzC,EAAgD,KAAKC,KAArD;AACA,mBAAKiB,WAAL,IAAoB,KAAKA,WAAL,CAAiB,KAAKJ,aAAtB,CAApB;AACH;AACJ;AACJ;;AA1DuC,O;AA6D5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["\nimport { _decorator, Component, Node, Vec3, tween, Vec2, v3, v2, log } from 'cc';\nimport { posAdd } from '../utils/functions';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = DInertiaMove\n * DateTime = Tue Mar 15 2022 11:02:34 GMT+0800 (中国标准时间)\n * Author = maikx123456\n * FileBasename = DInertiaMove.ts\n * FileBasenameNoExtension = DInertiaMove\n * URL = db://assets/scripts/framework/ui/DInertiaMove.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\n * 惯性移动组件\n */\n\n@ccclass('DInertiaMove')\nexport class DInertiaMove extends Component {\n\n    private _autoOffPos: Vec2; //每一帧的偏移值\n    private drag: number = 0.97; //摩擦系数\n    private isAutoScrolling: boolean = false;\n    private _minX: number;\n    private _maxX: number;\n\n    private _onStop: Function;\n    public get onStop(): Function {\n        return this._onStop;\n    }\n    public set onStop(value: Function) {\n        this._onStop = value;\n    }\n\n    private _increasedPos: Vec3; //每一帧增加的向量\n\n    public onPosChange:Function;\n\n    start() {\n    }\n    \n    move(byPos: Vec2, minX?: number, maxX?: number) {\n        this._autoOffPos = byPos\n        this.isAutoScrolling = true\n        this._minX = minX\n        this._maxX = maxX\n    }\n\n    stop() {\n        this.isAutoScrolling = false\n        this._autoOffPos = v2(0, 0)\n        this.onStop && this.onStop()\n    }\n\n    update(deltaTime: number) {\n        if (this.isAutoScrolling) {\n            this._autoOffPos = this._autoOffPos.multiplyScalar(this.drag)\n\n            //判断结束\n            let newPos = this.node.position.clone().add(v3(this._autoOffPos.x, this._autoOffPos.y))\n            if (this._minX && newPos.x < this._minX) {\n                newPos.x = this._minX\n            }\n            if (this._maxX && newPos.x > this._maxX) {\n                newPos.x = this._maxX\n            }\n\n            this._increasedPos = newPos.subtract(this.node.position)\n            let dis =  this._increasedPos.length()\n            if (dis < 2)\n                this.stop()\n            else{\n                posAdd(this.node, this._autoOffPos, this._minX, this._maxX)\n                this.onPosChange && this.onPosChange(this._increasedPos)\n            }\n        }\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/zh/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/zh/scripting/life-cycle-callbacks.html\n */\n"]}