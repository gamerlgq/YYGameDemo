{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/GameDemoReal/assets/scripts/app/views/fight/layer/BloodLayer.ts"],"names":["BloodLayer","instantiate","Prefab","Vec3","ResourcesLoader","fightActionMgr","BloodEffect","fightEventMgr","FightConstant","FightLayerBase","RoleLayer","Blood_Number_Prefab_Path","FightHPAction","Action_HP_Damage","Action_HP_Cure","Action_HP_Crit","Action_HP_Absort","Blood_Number_Offest","init","_initListeners","addEventListener","FightEvent","Blood_Change","_onBloodChange","bind","event","data","getEventData","_showBloodChange","fightEventData","Data","result","bloodType","path","prefab","loadPromise","prefabNode","node","addChild","tar","target","roleLayer","getCommonentInLayer","FightLayer","ROLE","pos","getFomationPos","camp","formationIndex","add","position","num","com","getComponent","setType","setNumber","show"],"mappings":";;;gKAsBaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAtBJC,MAAAA,W,OAAAA,W;AAAwBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;;AAChCC,MAAAA,e,iBAAAA,e;;AACiBC,MAAAA,c,iBAAAA,c;;AACjBC,MAAAA,W,iBAAAA,W;;AAGAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;AAGHC,MAAAA,wB,GAA2B;AAC7B,SAAC;AAAA;AAAA,4CAAcC,aAAd,CAA4BC,gBAA7B,GAA+C,8BADlB;AAE7B,SAAC;AAAA;AAAA,4CAAcD,aAAd,CAA4BE,cAA7B,GAA6C,8BAFhB;AAG7B,SAAC;AAAA;AAAA,4CAAcF,aAAd,CAA4BG,cAA7B,GAA6C,8BAHhB;AAI7B,SAAC;AAAA;AAAA,4CAAcH,aAAd,CAA4BI,gBAA7B,GAA+C;AAJlB,O;AAQ3BC,MAAAA,mB,GAAsB,IAAId,IAAJ,CAAS,CAAT,EAAW,GAAX,EAAe,CAAf,C;;4BAEfH,U,GAAN,MAAMA,UAAN;AAAA;AAAA,4CAAwC;AAEpCkB,QAAAA,IAAI,GAAE;AACT,eAAKC,cAAL;AACH;;AAEOA,QAAAA,cAAc,GAAG;AACrB;AAAA;AAAA,8CAAcC,gBAAd,CAA+B;AAAA;AAAA,8CAAcC,UAAd,CAAyBC,YAAxD,EAAqE,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAArE;AACH;;AAEOD,QAAAA,cAAc,CAACE,KAAD,EAAmB;AACrC,cAAIC,IAAoC,GAAGD,KAAK,CAACE,YAAN,EAA3C;;AACA,eAAKC,gBAAL,CAAsBF,IAAtB;AACH;;AAE6B,cAAhBE,gBAAgB,CAACC,cAAD,EAAiD;AAC3E,cAAIH,IAAI,GAAGG,cAAc,CAACC,IAA1B;AACA,cAAIC,MAAM,GAAGL,IAAI,CAACK,MAAlB;AACA,cAAIC,SAAS,GAAGD,MAAM,CAAC,CAAD,CAAN,IAAa;AAAA;AAAA,8CAAcnB,aAAd,CAA4BC,gBAAzD,CAH2E,CAK3E;;AACA,cAAIoB,IAAI,GAAGtB,wBAAwB,CAACqB,SAAD,CAAnC;AACA,cAAIE,MAAa,GAAG,MAAM;AAAA;AAAA,kDAAgBC,WAAhB,CAA4BF,IAA5B,EAAiC/B,MAAjC,CAA1B;AACA,cAAIkC,UAAe,GAAGnC,WAAW,CAACiC,MAAD,CAAjC;AACA,eAAKG,IAAL,CAAUC,QAAV,CAAmBF,UAAnB,EAT2E,CAU3E;;AACA,cAAIG,GAAG,GAAGb,IAAI,CAACc,MAAf;AACA,cAAIC,SAAS,GAAG;AAAA;AAAA,gDAAeC,mBAAf,CAAmC;AAAA;AAAA,8CAAcC,UAAd,CAAyBC,IAA5D;AAAA;AAAA,qCAAhB;AACA,cAAIC,GAAG,GAAGJ,SAAS,CAACK,cAAV,CAAyBP,GAAG,CAACQ,IAA7B,EAAkCR,GAAG,CAACS,cAAtC,CAAV;AACAH,UAAAA,GAAG,GAAGA,GAAG,CAACI,GAAJ,CAAQhC,mBAAR,CAAN;AACAmB,UAAAA,UAAU,CAACc,QAAX,GAAsBL,GAAtB,CAf2E,CAiB3E;;AACA,cAAIM,GAAG,GAAGpB,MAAM,CAAC,CAAD,CAAhB;AACA,cAAIqB,GAAG,GAAGhB,UAAU,CAACiB,YAAX;AAAA;AAAA,yCAAV;AACAD,UAAAA,GAAG,CAACE,OAAJ,CAAYtB,SAAZ;AACAoB,UAAAA,GAAG,CAACG,SAAJ,CAAcJ,GAAd;AACAC,UAAAA,GAAG,CAACI,IAAJ;AACH;;AAtC0C,O","sourcesContent":["import { instantiate, log, Node, Prefab, Vec3 } from \"cc\";\nimport { ResourcesLoader } from \"../../../../framework/data/ResourcesLoader\";\nimport { FightActionData, fightActionMgr } from \"../action/FightActionMgr\";\nimport { BloodEffect } from \"../effect/Effect\";\nimport { FightEvent } from \"../event/FightEvent\";\nimport { FightEventDataType } from \"../event/FightEventDataType\";\nimport { fightEventMgr } from \"../event/FightEventMgr\";\nimport { FightConstant } from \"../FightConstant\";\nimport { FightLayerBase } from \"./FightLayerBase\";\nimport { RoleLayer } from \"./RoleLayer\";\n\n\nconst Blood_Number_Prefab_Path = {\n    [FightConstant.FightHPAction.Action_HP_Damage]:\"fight/prefabs/effect/numbers\",\n    [FightConstant.FightHPAction.Action_HP_Cure]:\"fight/prefabs/effect/numbers\",\n    [FightConstant.FightHPAction.Action_HP_Crit]:\"fight/prefabs/effect/numbers\",\n    [FightConstant.FightHPAction.Action_HP_Absort]:\"fight/prefabs/effect/numbers\"\n}\n\n\nconst Blood_Number_Offest = new Vec3(0,250,0);\n\nexport class BloodLayer extends FightLayerBase {\n   \n    public init(){\n        this._initListeners();\n    }\n\n    private _initListeners() {\n        fightEventMgr.addEventListener(FightConstant.FightEvent.Blood_Change,this._onBloodChange.bind(this));\n    }\n\n    private _onBloodChange(event:FightEvent) {\n        let data:FightEventDataType.Blood_Change = event.getEventData();\n        this._showBloodChange(data);\n    }\n\n    private async _showBloodChange(fightEventData:FightEventDataType.Blood_Change) {\n        let data = fightEventData.Data;\n        let result = data.result;\n        let bloodType = result[1] || FightConstant.FightHPAction.Action_HP_Damage;\n\n        // load prefab\n        let path = Blood_Number_Prefab_Path[bloodType]\n        let prefab:Prefab = await ResourcesLoader.loadPromise(path,Prefab);\n        let prefabNode:Node = instantiate(prefab);\n        this.node.addChild(prefabNode);\n        // set prefab node position\n        let tar = data.target;\n        let roleLayer = fightActionMgr.getCommonentInLayer(FightConstant.FightLayer.ROLE,RoleLayer);\n        let pos = roleLayer.getFomationPos(tar.camp,tar.formationIndex);\n        pos = pos.add(Blood_Number_Offest);\n        prefabNode.position = pos;\n\n        // set blood info\n        let num = result[4]\n        let com = prefabNode.getComponent(BloodEffect);\n        com.setType(bloodType);\n        com.setNumber(num);        \n        com.show();\n    }\n}"]}