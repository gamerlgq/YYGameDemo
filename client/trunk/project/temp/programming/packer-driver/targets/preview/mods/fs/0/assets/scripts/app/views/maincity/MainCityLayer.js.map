{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/GameDemoReal/assets/scripts/app/views/maincity/MainCityLayer.ts"],"names":["_decorator","Node","log","v2","audioMgr","sceneMgr","LayerBase","MulitMoveingBgs","sceneTriggerMgr","viewRegisterMgr","ccclass","property","MainCityLayer","onLoad","addTriggrt","getViewInfo","System","onTrigger","bind","start","playMusic","_initBgTouch","addMainEventTrigger","mainCityLayer","on","EventType","TOUCH_START","onBgTouchStart","TOUCH_MOVE","onBgTouchMove","TOUCH_END","onBgTouchEnd","_deltaPos","mulitBgComp","stop","event","getDelta","multiplyScalar","x","move","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,I,OAAAA,I;AAAYC,MAAAA,G,OAAAA,G;AAAuDC,MAAAA,E,OAAAA,E;;AAC1FC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,e,iBAAAA,e;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBX,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;+BAGaY,a,WADZF,OAAO,CAAC,eAAD,C,UASHC,QAAQ;AAAA;AAAA,6C,UAGRA,QAAQ,CAACV,IAAD,C,oCAZb,MACaW,aADb;AAAA;AAAA,kCAC6C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAkBzCC,QAAAA,MAAM,GAAE;AACJ;AACA;AAAA;AAAA,kDAAgBC,UAAhB,CAA2B;AAAA;AAAA,kDAAgBC,WAAhB,CAA4B,UAA5B,EAAwC,eAAxC,EAAyDC,MAApF,EAA4F,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAA5F,EAAsH,CAAtH;AAEH;;AAEDC,QAAAA,KAAK,GAAI;AACL;AACA;AAAA;AAAA,oCAASC,SAAT,CAAmB,yBAAnB;;AACA,eAAKC,YAAL,GAHK,CAKL;;;AACA;AAAA;AAAA,oCAASC,mBAAT;AACH;;AAEOL,QAAAA,SAAS,GAAG;AAChBf,UAAAA,GAAG,CAAC,mBAAD,CAAH;AACH;;AAEOmB,QAAAA,YAAY,GAAG;AACnB,eAAKE,aAAL,CAAmBC,EAAnB,CAAsBvB,IAAI,CAACwB,SAAL,CAAeC,WAArC,EAAkD,KAAKC,cAAL,CAAoBT,IAApB,CAAyB,IAAzB,CAAlD;AACA,eAAKK,aAAL,CAAmBC,EAAnB,CAAsBvB,IAAI,CAACwB,SAAL,CAAeG,UAArC,EAAiD,KAAKC,aAAL,CAAmBX,IAAnB,CAAwB,IAAxB,CAAjD;AACA,eAAKK,aAAL,CAAmBC,EAAnB,CAAsBvB,IAAI,CAACwB,SAAL,CAAeK,SAArC,EAAgD,KAAKC,YAAL,CAAkBb,IAAlB,CAAuB,IAAvB,CAAhD;AACH;;AAEOS,QAAAA,cAAc,GAAG;AACrB,eAAKK,SAAL,GAAiB,IAAjB;AACA,eAAKC,WAAL,CAAiBC,IAAjB;AACH;;AAEOL,QAAAA,aAAa,CAACM,KAAD,EAAmB;AACpC,eAAKH,SAAL,GAAiBG,KAAK,CAACC,QAAN,EAAjB;;AACA,eAAKJ,SAAL,CAAeK,cAAf,CAA8B,GAA9B;;AACA,eAAKL,SAAL,GAAiB7B,EAAE,CAAC,KAAK6B,SAAL,CAAeM,CAAhB,EAAmB,CAAnB,CAAnB;AACA,eAAKL,WAAL,CAAiBM,IAAjB,CAAsB,KAAKP,SAA3B,EAAsC,KAAtC;AACH;;AAEOD,QAAAA,YAAY,GAAG;AACnB,cAAI,CAAC,KAAKC,SAAV,EAAqB;AACjB;AACH;;AACD,eAAKC,WAAL,CAAiBM,IAAjB,CAAsB,KAAKP,SAA3B,EAAsC,IAAtC;AACH;;AAEDQ,QAAAA,MAAM,CAAEC,SAAF,EAAqB,CACvB;AAEH;;AAjEwC,O;;;;;;;;;;;AAoE7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["\nimport { _decorator, Component, Node, find, log, EventTouch, v3, Vec3, Vec2, tween, Tween, easing, v2 } from 'cc';\nimport { audioMgr } from '../../../framework/core/audio/AudioManager';\nimport { sceneMgr } from '../../../framework/core/SceneMgr';\nimport { DInertiaMove } from '../../../framework/ui/DInertiaMove';\nimport { LayerBase } from '../../../framework/ui/LayerBase';\nimport { MulitMoveingBgs } from '../../../framework/ui/MulitMoveingBgs';\nimport { sceneTriggerMgr } from '../../../framework/utils/SceneTriggerMgr';\nimport { viewRegisterMgr, ViewRegisterMgr } from '../../define/ViewRegisterMgr';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = MainCityLayer\n * DateTime = Tue Mar 08 2022 14:26:57 GMT+0800 (中国标准时间)\n * Author = Steven_Greeard\n * FileBasename = MainCityLayer.ts\n * FileBasenameNoExtension = MainCityLayer\n * URL = db://assets/scripts/app/views/maincity/MainCityLayer.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\n *\n */\n \n@ccclass('MainCityLayer')\nexport class MainCityLayer extends LayerBase {\n    // [1]\n    // dummy = '';\n\n    // [2]\n    // @property\n    // serializableDummy = 0;\n\n    @property(MulitMoveingBgs)\n    mulitBgComp:MulitMoveingBgs\n\n    @property(Node)\n    mainCityLayer:Node\n\n    _deltaPos:Vec2;\n    _bgDInertiaMove:DInertiaMove\n\n\n    onLoad(){\n        //触发器写在onLoad，否则切换刚加入主场景的时候，start还没开始执行\n        sceneTriggerMgr.addTriggrt(viewRegisterMgr.getViewInfo(\"maincity\", \"MainCityLayer\").System, this.onTrigger.bind(this),1)\n\n    }\n    \n    start () {\n        // [3]\n        audioMgr.playMusic(\"maincity/avs/bgm_liyuan\")\n        this._initBgTouch()\n\n        //全局事件监听\n        sceneMgr.addMainEventTrigger()\n    }\n\n    private onTrigger() {\n        log(\"main city trigger\")\n    }\n\n    private _initBgTouch() {\n        this.mainCityLayer.on(Node.EventType.TOUCH_START, this.onBgTouchStart.bind(this))\n        this.mainCityLayer.on(Node.EventType.TOUCH_MOVE, this.onBgTouchMove.bind(this))\n        this.mainCityLayer.on(Node.EventType.TOUCH_END, this.onBgTouchEnd.bind(this))\n    }\n\n    private onBgTouchStart() {\n        this._deltaPos = null\n        this.mulitBgComp.stop()\n    }\n\n    private onBgTouchMove(event:EventTouch) {\n        this._deltaPos = event.getDelta()\n        this._deltaPos.multiplyScalar(1.5)\n        this._deltaPos = v2(this._deltaPos.x, 0)\n        this.mulitBgComp.move(this._deltaPos, false)\n    }\n    \n    private onBgTouchEnd() {\n        if (!this._deltaPos) {\n            return\n        }\n        this.mulitBgComp.move(this._deltaPos, true)\n    }\n\n    update (deltaTime: number) {\n        // [4]\n        \n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/zh/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/zh/scripting/life-cycle-callbacks.html\n */\n"]}