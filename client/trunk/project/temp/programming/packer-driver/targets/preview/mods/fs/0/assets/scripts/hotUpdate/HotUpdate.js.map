{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/YYGameDemo/client/trunk/project/assets/scripts/hotUpdate/HotUpdate.ts"],"names":["_decorator","Component","director","Label","sys","log","ProgressBar","EnterApp","ccclass","property","HotUpdate","start","isNative","checkUpdate","tipsLabel","string","progressBar","progress","goMainScene","onLoad","_storagePath","jsb","fileUtils","getWritablePath","console","versionCompareHandle","versionA","versionB","vA","split","vB","i","length","a","parseInt","b","_am","AssetsManager","setVerifyCallback","path","asset","compressed","expectedMD5","md5","relativePath","size","data","getDataFromFile","md5Str","MD5_2","checkCb","event","getEventCode","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","NetworkType","WWAN","device","getNetworkType","hotUpdate","getDownloadByteStr","byte","suffix","toFixed","updateCb","needRestart","failed","UPDATE_PROGRESSION","downloadByte","getDownloadedBytes","totalByte","getTotalBytes","UPDATE_FINISHED","UPDATE_FAILED","getMessage","ERROR_UPDATING","getAssetId","ERROR_DECOMPRESS","setEventCallback","searchPaths","getSearchPaths","newPaths","getLocalManifest","JSON","stringify","Array","prototype","unshift","apply","localStorage","setItem","setSearchPaths","bind","update","getState","State","UNINITED","loadLocalManifest","isLoaded","scheduleOnce","dt","loadScene"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, js, director, Label, sys, assetManager, log, ProgressBar, game } from 'cc';\nimport { EnterApp } from '../app/EnterApp';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = HotUpdate\n * DateTime = Tue Mar 08 2022 10:55:51 GMT+0800 (中国标准时间)\n * Author = Steven_Greeard\n * FileBasename = HotUpdate.ts\n * FileBasenameNoExtension = HotUpdate\n * URL = db://assets/scripts/hotUpdate/HotUpdate.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\n *\n */\n\n\n@ccclass('HotUpdate')\nexport class HotUpdate extends Component {\n    @property(Label)\n    private tipsLabel: Label\n\n    @property(ProgressBar)\n    private progressBar: ProgressBar;\n\n    private _am: jsb.AssetsManager = null!;\n    private _storagePath = '';\n\n\n\n    start() {\n        if (sys.isNative) {\n            this.checkUpdate()\n        }\n        else {\n            this.tipsLabel.string = \"更新完成.\"\n            this.progressBar.progress = 1\n            this.goMainScene()\n        }\n    }\n\n    onLoad() {\n        if (!sys.isNative) {\n            return;\n        }\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'hotupdate');\n        console.log('Storage path for remote asset : ' + this._storagePath);\n\n        // Setup your own version compare handler, versionA and B is versions in string\n        // if the return value greater than 0, versionA is greater than B,\n        // if the return value equals 0, versionA equals to B,\n        // if the return value smaller than 0, versionA is smaller than B.\n        let versionCompareHandle = function (versionA: string, versionB: string) {\n            console.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || '0');\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        // Init with empty manifest url for testing custom manifest\n        this._am = new jsb.AssetsManager('', this._storagePath, versionCompareHandle);\n        this._am.setVerifyCallback(function (path: string, asset: any) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n\n            if (compressed) {\n                log(\"Verification passed : \" + relativePath)\n                return true\n            }\n\n            let data = jsb.fileUtils.getDataFromFile(path);\n            let md5Str = MD5_2(data)\n\n            log(\"expectedMD5:\" + expectedMD5 + \"  md5Str:\" + md5Str)\n            if (expectedMD5 != md5Str) {\n                log(\"验证失败\")\n                return false\n            }\n\n            return true\n        });\n    }\n\n    checkCb(event: any) {\n        console.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.tipsLabel.string = \"No local manifest file found, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.tipsLabel.string = \"下载更新文件失败\";\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.tipsLabel.string = \"更新完成.\";\n                this.progressBar.progress = 1\n                this.goMainScene()\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                if (sys.NetworkType.WWAN == jsb.device.getNetworkType()) {\n\n                }\n                else {\n                    this.tipsLabel.string = '正准备更新...'\n                    this.hotUpdate()\n                }\n                break;\n            default:\n                return;\n        }\n\n    }\n\n    private getDownloadByteStr(byte: number) {\n        let suffix = \"B\"\n\n        //kb\n        if (byte > 1024) {\n            suffix = \"KB\"\n            byte /= 1024\n\n            //mb\n            if (byte > 1024) {\n                suffix = \"M\"\n                byte /= 1024\n            }\n\n            return byte.toFixed(1) + suffix\n        }\n\n        return byte + suffix\n    }\n\n    updateCb(event: any) {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.tipsLabel.string = 'No local manifest file found, hot update skipped.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                let downloadByte: number = event.getDownloadedBytes()\n                let totalByte: number = event.getTotalBytes()\n                log(\"updateing... \", downloadByte, \" \"+ totalByte)\n                this.tipsLabel.string = this.getDownloadByteStr(downloadByte) + \"/\" + this.getDownloadByteStr(totalByte)\n                this.progressBar.progress = downloadByte/totalByte\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.tipsLabel.string = '获取更新文件失败';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.tipsLabel.string = 'Already up to date with the latest remote version.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                this.tipsLabel.string = '更新完成.'\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.tipsLabel.string = '更新失败: ' + event.getMessage();\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                this.tipsLabel.string = '更新失败: ' + event.getAssetId() + ', ' + event.getMessage();\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                this.tipsLabel.string = event.getMessage();\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            this._am.setEventCallback(null!);\n        }\n\n        if (needRestart) {\n            this._am.setEventCallback(null!);\n            // Prepend the manifest's search path\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            console.log(JSON.stringify(newPaths));\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n\n            this.goMainScene()\n        }\n    }\n\n    hotUpdate() {\n        log(\"hotupdate start...\")\n        this._am.setEventCallback(this.updateCb.bind(this));\n        this._am.update();\n    }\n\n    checkUpdate() {\n        this.progressBar.progress = 0\n        this.tipsLabel.string = \"正在检查更新...\"\n\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            this._am.loadLocalManifest('project.manifest');\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            this.tipsLabel.string = \"Failed to load local manifest ...\"\n            return;\n        }\n        this._am.setEventCallback(this.checkCb.bind(this));\n        this._am.checkUpdate();\n    }\n\n    goMainScene() {\n        if (this._am) {\n            this._am.setEventCallback(null)            \n        }\n\n        this.scheduleOnce((dt: number) => {\n            director.loadScene(\"main\", () => {\n                new EnterApp();\n            });\n        }, 1);\n    }\n}\n"]}