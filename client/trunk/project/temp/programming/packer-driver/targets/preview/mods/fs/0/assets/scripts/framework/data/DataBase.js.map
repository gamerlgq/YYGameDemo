{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/YYGameDemo/client/trunk/project/assets/scripts/framework/data/DataBase.ts"],"names":["DataBase","error","log","resources","ResourcesLoader","constructor","dataHandlerName","fileName","parser","Map","_dataHandlerName","_fileName","_parser","loadDataWithNameKey","namekey","func","_parseFileName","getData","toString","_data","has","get","delData","delete","getAllData","showAll","_loadFile","load","jsonData","jsonAsset","data","json","parse","set","release"],"mappings":";;;sEAgBaA,Q;;;;;;;;;;;;;;;;;;;AAhBJC,MAAAA,K,OAAAA,K;AAAkBC,MAAAA,G,OAAAA,G;AAAKC,MAAAA,S,OAAAA,S;;AAEvBC,MAAAA,e,iBAAAA,e;;;;;;;0BAcIJ,Q,GAAN,MAAMA,QAAN,CAAe;AAElB;AAEA;AAEA;AAEA;AAGAK,QAAAA,WAAW,CAACC,eAAD,EAA0BC,QAA1B,EAA4CC,MAA5C,EAA2E;AAAA,oDARnD,EAQmD;;AAAA,6CAN1D,EAM0D;;AAAA,2CAJpD,IAIoD;;AAAA,yCAFpD,IAAIC,GAAJ,EAEoD;;AAClF,eAAKC,gBAAL,GAAwBJ,eAAxB;AACA,eAAKK,SAAL,GAAiBJ,QAAjB;AACA,eAAKK,OAAL,GAAeJ,MAAf;AACH,SAfiB,CAiBlB;;;AACOK,QAAAA,mBAAmB,CAACC,OAAD,EAAkBC,IAAlB,EAAsC;AAC5D,eAAKC,cAAL,CAAoBF,OAApB,EAA4BC,IAA5B;AACH;;AAEME,QAAAA,OAAO,CAACH,OAAD,EAA4B;AAAA,cAA3BA,OAA2B;AAA3BA,YAAAA,OAA2B,GAAT,EAAS;AAAA;;AACtCA,UAAAA,OAAO,GAAGA,OAAO,CAACI,QAAR,EAAV;;AACA,cAAI,KAAKC,KAAL,CAAWC,GAAX,CAAeN,OAAf,CAAJ,EAA6B;AACzB,mBAAO,KAAKK,KAAL,CAAWE,GAAX,CAAeP,OAAf,CAAP;AACH;;AACD,iBAAOb,KAAK,CAAC,uBAAD,EAA0B,KAAKU,SAAL,GAAiBG,OAA3C,CAAZ;AACH;;AAEMQ,QAAAA,OAAO,CAACR,OAAD,EAAwB;AAClC,cAAIR,eAAe,GAAG,KAAKK,SAAL,GAAiBG,OAAvC;;AACA,cAAI,KAAKK,KAAL,CAAWC,GAAX,CAAed,eAAf,CAAJ,EAAqC;AACjC,iBAAKa,KAAL,CAAWI,MAAX,CAAkBjB,eAAlB;AACH;AACJ;;AAEMkB,QAAAA,UAAU,GAAQ;AACrB,iBAAO,KAAKL,KAAZ;AACH;;AAEMM,QAAAA,OAAO,GAAS;AACnBvB,UAAAA,GAAG,CAAC,KAAKiB,KAAN,CAAH;AACH;;AAEOH,QAAAA,cAAc,CAACF,OAAD,EAAkBC,IAAlB,EAAsC;AACxD;AACA,cAAIR,QAAQ,GAAG,KAAKI,SAAL,GAAiBG,OAAhC;;AACA,eAAKY,SAAL,CAAenB,QAAf,EAAyBO,OAAzB,EAAkCC,IAAlC;AACH,SAjDiB,CAmDlB;;;AACQW,QAAAA,SAAS,CAACnB,QAAD,EAAkBO,OAAlB,EAAkCC,IAAlC,EAA6D;AAC1E;AAAA;AAAA,kDAAgBY,IAAhB,CAAqBpB,QAArB,EAA+BqB,QAAD,IAAc;AACxC,gBAAI,CAACA,QAAL,EAAe;AACXb,cAAAA,IAAI,CAAC,KAAD,CAAJ;AACA;AACH;;AAED,gBAAIc,SAAS,GAAcD,QAA3B;AACA,gBAAIE,IAAI,GAAGD,SAAS,CAACE,IAArB;;AAEA,gBAAI,KAAKnB,OAAT,EAAkB;AACdkB,cAAAA,IAAI,GAAG,KAAKlB,OAAL,CAAaoB,KAAb,CAAmBF,IAAnB,EAAyB,KAAKpB,gBAA9B,EAAgDI,OAAhD,CAAP;AACH;;AACD,iBAAKK,KAAL,CAAWc,GAAX,CAAenB,OAAO,CAACI,QAAR,EAAf,EAAmCY,IAAnC;;AAEA,gBAAIf,IAAJ,EAAS;AACLA,cAAAA,IAAI,CAAC,IAAD,CAAJ;AACH;;AAEDZ,YAAAA,SAAS,CAAC+B,OAAV,CAAkB3B,QAAlB;AACH,WAnBD;AAoBH;;AAzEiB,O","sourcesContent":["import { error, JsonAsset, log, resources } from \"cc\";\nimport { DataParserBase } from \"./DataParserBase\";\nimport { ResourcesLoader } from \"./ResourcesLoader\";\n\n/*\n * @Author: liuguoqing\n * @Date: 2022-03-03 08:54:10\n * @LastEditors: liuguoqing\n * @LastEditTime: 2022-03-06 14:47:17\n * @Description: file content\n */\n\nexport interface DataCallback {\n    (done: boolean):void;\n} \n\nexport class DataBase {\n    \n    // 配置表handle name\n    private _dataHandlerName: string = \"\";\n    // 配置表文件名\n    private _fileName: string = \"\";\n    // 多语言解析器\n    private _parser: DataParserBase = null;\n    // 缓存起来(key:namekey,value:配置表内容) 例如:hero_01.json,filename:hero_,namekey:01\n    private _data: Map<string, any> = new Map();\n\n    constructor(dataHandlerName: string, fileName: string, parser: DataParserBase | null) {\n        this._dataHandlerName = dataHandlerName;\n        this._fileName = fileName;\n        this._parser = parser;\n    }\n\n    // 加载\n    public loadDataWithNameKey(namekey: string, func?: DataCallback){\n        this._parseFileName(namekey,func)\n    }\n\n    public getData(namekey: string = \"\"): any {\n        namekey = namekey.toString();\n        if (this._data.has(namekey)) {\n            return this._data.get(namekey);\n        }\n        return error(\"Can't Find Json File:\", this._fileName + namekey);\n    }\n\n    public delData(namekey: string): void {\n        let dataHandlerName = this._fileName + namekey;\n        if (this._data.has(dataHandlerName)) {\n            this._data.delete(dataHandlerName);\n        }\n    }\n\n    public getAllData(): any {\n        return this._data;\n    }\n\n    public showAll(): void {\n        log(this._data);\n    }\n\n    private _parseFileName(namekey: string, func?:DataCallback) {\n        // filename = genral_(this._fileName) + 1(namekey) \n        let fileName = this._fileName + namekey;\n        this._loadFile(fileName, namekey, func);\n    }\n\n    // 加载json\n    private _loadFile(fileName: string,namekey: string,func?: DataCallback): void {\n        ResourcesLoader.load(fileName,(jsonData) => {\n            if (!jsonData) {\n                func(false);\n                return;\n            }\n\n            let jsonAsset = <JsonAsset>jsonData;\n            let data = jsonAsset.json;\n\n            if (this._parser) {\n                data = this._parser.parse(data, this._dataHandlerName, namekey);\n            }\n            this._data.set(namekey.toString(), data);\n\n            if (func){\n                func(true);\n            }\n            \n            resources.release(fileName);\n        });\n    }\n\n}"]}