{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/GameDemoReal/assets/scripts/app/views/loading/TransLoadingLayer.ts"],"names":["Animation","Label","ProgressBar","_decorator","sceneMgr","ResourcesLoader","LayerBase","ccclass","property","TransLoadingLayer","setResLoadingList","list","_loadingResList","start","length","_playTransAnimation","_loadingRes","ani","node","getComponent","play","loadList","finishNum","max","oldVal","bar","progress","newVal","percent","string","Math","floor","setEnterCalback","cb","_enterCallback","setCompleteCallback","_completeCallback","onEnterCallback","onTransComplete","data","removeTransitionLayer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAYC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,U,OAAAA,U;;AAEpCC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;mCAGjBM,iB,WADZF,OAAO,CAAC,mBAAD,C,UAGHC,QAAQ,CAACP,KAAD,C,UAGRO,QAAQ,CAACN,WAAD,C,oCANb,MACaO,iBADb;AAAA;AAAA,kCACiD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,kDAQX,IARW;;AAAA,qDASR,IATQ;;AAAA,mDAUL,IAVK;AAAA;;AAY7C;AACOC,QAAAA,iBAAiB,CAACC,IAAD,EAAoB;AACxC,eAAKC,eAAL,GAAuBD,IAAvB;AACH;;AAEDE,QAAAA,KAAK,GAAI;AACL,cAAI,CAAC,KAAKD,eAAN,IAAyB,KAAKA,eAAL,CAAqBE,MAArB,IAA+B,CAA5D,EAA8D;AAC1D,mBAAO,KAAKC,mBAAL,EAAP;AACH;;AAED,eAAKC,WAAL;AACH;;AAEOD,QAAAA,mBAAmB,GAAE;AACzB,cAAIE,GAAG,GAAG,KAAKC,IAAL,CAAUC,YAAV,CAAuBnB,SAAvB,CAAV;AACAiB,UAAAA,GAAG,CAACG,IAAJ;AACH;;AAEOJ,QAAAA,WAAW,GAAG;AAClB;AAAA;AAAA,kDAAgBK,QAAhB,CAAyB,KAAKT,eAA9B,EAA8C,CAACU,SAAD,EAAkBC,GAAlB,KAA+B;AACzE,gBAAIC,MAAM,GAAG,KAAKC,GAAL,CAASC,QAAtB;AACA,gBAAIC,MAAM,GAAGL,SAAS,GAAGC,GAAzB;;AACA,gBAAII,MAAM,GAAGH,MAAb,EAAqB;AACjBG,cAAAA,MAAM,GAAGH,MAAT;AACH;;AACD,iBAAKC,GAAL,CAASC,QAAT,GAAoBC,MAApB;AACA,iBAAKC,OAAL,CAAaC,MAAb,GAAsBC,IAAI,CAACC,KAAL,CAAWJ,MAAM,GAAG,GAApB,IAA2B,GAAjD;AACH,WARD,EAQE,MAAI;AACF,iBAAKZ,mBAAL;AACH,WAVD;AAWH;;AAEDiB,QAAAA,eAAe,CAACC,EAAD,EAAa;AACxB,eAAKC,cAAL,GAAsBD,EAAtB;AACH;;AAEDE,QAAAA,mBAAmB,CAACF,EAAD,EAAa;AAC5B,eAAKG,iBAAL,GAAyBH,EAAzB;AACH;;AAEDI,QAAAA,eAAe,GAAE;AACb,cAAI,KAAKH,cAAT,EAAwB;AACpB,iBAAKA,cAAL;AACH;AACJ;;AAEDI,QAAAA,eAAe,CAACC,IAAD,EAAa;AACxB,cAAI,KAAKH,iBAAT,EAA2B;AACvB,iBAAKA,iBAAL;AACH;;AACD;AAAA;AAAA,oCAASI,qBAAT;AACH;;AA/D4C,O;;;;;iBAG5B,I;;;;;;;iBAGE,I","sourcesContent":["\nimport { Animation, Label, log, ProgressBar, _decorator } from 'cc';\nimport { runInThisContext } from 'vm';\nimport { sceneMgr } from '../../../framework/core/SceneMgr';\nimport { ResourcesLoader } from '../../../framework/data/ResourcesLoader';\nimport { LayerBase } from '../../../framework/ui/LayerBase';\nconst { ccclass, property } = _decorator;\n \n@ccclass('TransLoadingLayer')\nexport class TransLoadingLayer extends LayerBase {\n    \n    @property(Label)\n    percent: Label = null;\n\n    @property(ProgressBar)\n    bar: ProgressBar = null;\n\n    private _enterCallback:Function = null\n    private _completeCallback:Function = null\n    private _loadingResList:Array<string> = null;\n\n    // 自定义加载列表,如果为空则播放动画后显示场景\n    public setResLoadingList(list:Array<string>){\n        this._loadingResList = list;\n    }\n\n    start () {\n        if (!this._loadingResList || this._loadingResList.length == 0){\n            return this._playTransAnimation();\n        }\n\n        this._loadingRes();\n    }\n\n    private _playTransAnimation(){\n        let ani = this.node.getComponent(Animation);\n        ani.play();\n    }\n\n    private _loadingRes() {\n        ResourcesLoader.loadList(this._loadingResList,(finishNum:number,max:number)=>{\n            let oldVal = this.bar.progress;\n            let newVal = finishNum / max;\n            if (newVal < oldVal) {\n                newVal = oldVal;\n            }\n            this.bar.progress = newVal;\n            this.percent.string = Math.floor(newVal * 100) + \"%\";\n        },()=>{\n            this._playTransAnimation();\n        })     \n    }\n\n    setEnterCalback(cb:Function){\n        this._enterCallback = cb;\n    }\n\n    setCompleteCallback(cb:Function){\n        this._completeCallback = cb;\n    }\n\n    onEnterCallback(){\n        if (this._enterCallback){\n            this._enterCallback()\n        }\n    }\n\n    onTransComplete(data:string){\n        if (this._completeCallback){\n            this._completeCallback()\n        }\n        sceneMgr.removeTransitionLayer();\n    }\n}"]}