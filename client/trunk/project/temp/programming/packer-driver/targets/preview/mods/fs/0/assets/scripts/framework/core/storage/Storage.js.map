{"version":3,"sources":["file:///Users/steven/Workspaces/CocosCreatorProjects/3D/GameDemoReal/assets/scripts/framework/core/storage/Storage.ts"],"names":["sys","PREVIEW","EncryptUtil","md5","_key","_iv","_id","init","key","iv","setUser","id","set","value","console","error","warn","remove","JSON","stringify","e","aesEncrypt","localStorage","setItem","get","defaultValue","str","getItem","aesDecrypt","Number","parse","removeItem","clear","storage"],"mappings":"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","sourcesContent":["/**\n * @file SqlUtil.ts\n * @description 本地化存储方案\n */\nimport { sys } from \"cc\";\nimport { PREVIEW } from \"cc/env\";\nimport { EncryptUtil } from \"./EncryptUtil\";\nimport { md5 } from \"./Md5\";\n\nexport module storage {\n    let _key: string | null = null;\n    let _iv: string | null = null;\n    let _id: number = -1;\n\n    /**\n     * 初始化密钥\n     * @param key aes加密的key \n     * @param iv  aes加密的iv\n     */\n    export function init(key: string, iv: string) {\n        _key = md5(key);\n        _iv = md5(iv);\n    }\n\n    /**\n     * 设置用户标识\n     * @param id \n     */\n    export function setUser(id: number) {\n        _id = id;\n    }\n\n    /**\n     * 存储\n     * @param key 存储key\n     * @param value 存储值\n     * @returns \n     */\n    export function set(key: string, value: any) {\n        key = `${key}_${_id}`;\n\n        if (null == key) {\n            console.error(\"存储的key不能为空\");\n            return;\n        }\n        if (!PREVIEW) {\n            key = md5(key);\n        }\n        if (null == value) {\n            console.warn(\"存储的值为空，则直接移除该存储\");\n            remove(key);\n            return;\n        }\n        if (typeof value === 'function') {\n            console.error(\"储存的值不能为方法\");\n            return;\n        }\n        if (typeof value === 'object') {\n            try {\n                value = JSON.stringify(value);\n            }\n            catch (e) {\n                console.error(`解析失败，str = ${value}`);\n                return;\n            }\n        }\n        else if (typeof value === 'number') {\n            value = value + \"\";\n        }\n        if (!PREVIEW && null != _key && null != _iv) {\n            try {\n                value = EncryptUtil.aesEncrypt(value, _key, _iv);\n            }\n            catch (e) {\n                value = null;\n            }\n        }\n        sys.localStorage.setItem(key, value);\n    }\n\n    /**\n     * 获取\n     * @param key 获取的key\n     * @param defaultValue 获取的默认值\n     * @returns \n     */\n    export function get(key: string, defaultValue?: any) {\n        if (null == key) {\n            console.error(\"存储的key不能为空\");\n            return;\n        }\n\n        key = `${key}_${_id}`;\n\n        if (!PREVIEW) {\n            key = md5(key);\n        }\n        let str: string | null = sys.localStorage.getItem(key);\n        if (null != str && '' !== str && !PREVIEW && null != _key && null != _iv) {\n            try {\n                str = EncryptUtil.aesDecrypt(str, _key, _iv);\n            }\n            catch (e) {\n                str = null;\n            }\n\n        }\n        if (null == defaultValue || typeof defaultValue === 'string') {\n            return str;\n        }\n        if (null === str) {\n            return defaultValue;\n        }\n        if (typeof defaultValue === 'number') {\n            return Number(str) || 0;\n        }\n        if (typeof defaultValue === 'boolean') {\n            return \"true\" == str; // 不要使用Boolean(\"false\");\n        }\n        if (typeof defaultValue === 'object') {\n            try {\n                return JSON.parse(str);\n            }\n            catch (e) {\n                console.error(\"解析数据失败,str=\" + str);\n                return defaultValue;\n            }\n\n        }\n        return str;\n    }\n\n    /**\n     * 移除某个值\n     * @param key 需要移除的key \n     * @returns \n     */\n    export function remove(key: string) {\n        if (null == key) {\n            console.error(\"存储的key不能为空\");\n            return;\n        }\n\n        key = `${key}_${_id}`;\n\n        if (!PREVIEW) {\n            key = md5(key);\n        }\n        sys.localStorage.removeItem(key);\n    }\n\n    /**\n     * 清空整个本地存储\n     */\n    export function clear() {\n        sys.localStorage.clear();\n    }\n}"]}